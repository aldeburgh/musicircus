define(["require","exports","module","famous/core/View","famous/core/Surface","famous/surfaces/ContainerSurface","famous/views/Scrollview","famous/core/Transform","famous/modifiers/StateModifier","famous/core/Modifier","famous/utilities/Timer","mods/Draggable","famous/transitions/Transitionable","famous/surfaces/ImageSurface","famous/transitions/Easing","famous/transitions/SnapTransition","famous/transitions/SpringTransition","views/MobileColumnItemView","views/ColumnItemView","data/DataArray","famous/inputs/GenericSync","famous/inputs/ScrollSync","famous/inputs/TouchSync"],function(o,i,t){function e(){m.apply(this,arguments),this.rootModifier=new g({size:[void 0,void 0],origin:[0,0],align:[0,0],transform:p.translate(0,-4e3,0)}),this.rootModifier.setTransform(p.translate(0,0,0),{duration:2e3,curve:"easeInOut"}),this.mainNode=this.add(this.rootModifier),this.total=10,this.n=0,this.ypos=0,this.volume=Math.pow(this.options.columnWidth/this.options.maxColumnWidth*100,2)/100,this.isMobile=this.options.isMobile,this.columnItemViews=[],this.columnItemMods=[],this.endEvent=!1,s.call(this)}function s(){var o=this;this.videoData=this.options.columnData,0==Math.floor(2*Math.random())?(this.darkOrLight="dark",this.itemColors=T.getDarkColors()):(this.darkOrLight="light",this.itemColors=T.getLightColors());this.scrollSurfaceHeight=this.videoData.length*(this.options.columnItemHeight+this.options.margin);var i;i=window.hudStart&&!WURFL.is_mobile?["scroll-surface-blur"]:["scroll-surface"],this.scrollSurface=new f({classes:i,size:[void 0,this.scrollSurfaceHeight],properties:{backgroundColor:"#cdcdcd",lineHeight:"200px",textAlign:"center",cursor:"pointer"}}),this.topScrollSurface=new h({size:[void 0,750],properties:{backgroundColor:"#cdcdcd",cursor:"pointer"}}),this.topScrollSurfaceModifier=new g({origin:[0,1],align:[0,0]});this.downArrow=new I({size:[129,116],content:"images/down_arrow.png",properties:{zIndex:50,pointerEvents:"all"}}),this.downArrowModifier=new g({origin:[.5,1],align:[0,0]});this.upArrow=new I({size:[129,116],content:"images/up_arrow.png",properties:{zIndex:50,pointerEvents:"all"}}),this.upArrowModifier=new g({origin:[.5,0],align:[0,1]}),this.bottomScrollSurface=new h({size:[void 0,750],properties:{backgroundColor:"#cdcdcd",lineHeight:"200px",cursor:"pointer"}}),this.bottomScrollSurfaceModifier=new g({origin:[0,0],align:[0,1]}),this.scrollSurface.add(this.topScrollSurfaceModifier).add(this.topScrollSurface),this.scrollSurface.add(this.downArrowModifier).add(this.downArrow),this.scrollSurface.add(this.bottomScrollSurfaceModifier).add(this.bottomScrollSurface),this.scrollSurface.add(this.upArrowModifier).add(this.upArrow),window.scrollSurfaces.push(this.scrollSurface),this.columnModifier=new w({transform:p.translate(0,0,0)}),this.scrollSurface.draggable=new S({projection:"y"}),this.scrollSurface.pipe(this.scrollSurface.draggable),this.columnItemViews=[];for(var t=0;t<this.videoData.length;t++)this.columnItemViews[t]=new C({margin:this.options.margin,size:[void 0,this.options.columnItemHeight+this.options.margin],id:t,playerId:this.videoData[t].code,playerTitle:this.videoData[t].title,playerSize:[this.options.YTwidth,this.options.YTHeight],ypos:t*(this.options.columnItemHeight+this.options.margin),parent:this,itemBackgroundColor:this.itemColors[t],isMobile:this.isMobile,audio:this.videoData[t].audio,darkOrLight:this.darkOrLight,photoUrl:this.videoData[t].image,numberColumns:this.options.columnCount,columnNumber:this.options.columnNumber,gutterWidth:this.options.boardViewRef.gutter}),this.columnItemMods[t]=new w({size:[void 0,this.options.columnItemHeight+this.options.margin],transform:p.translate(0,t*(this.options.columnItemHeight+this.options.margin),0)}),this.scrollSurface.add(this.columnItemMods[t]).add(this.columnItemViews[t]);this.mod=new g,this.trans={period:700,dampingRatio:.3,velocity:0},this.slowTrans={period:1e3,dampingRatio:.3,velocity:0},this.mainNode.add(this.columnModifier).add(this.mod).add(this.scrollSurface.draggable).add(this.scrollSurface),this.scrollSurface.draggable.on("start",function(){n(o)}),this.scrollSurface.draggable.on("end",function(){c(o)}),this.scrollSurface.draggable.on("end",function(){a(o)}),d.call(this),window.onpageshow=function(){r(o,o.columnItemViews[o.n],o.videoData[o.n].code,o.n)},window.onpagehide=function(){if(WURFL.is_mobile)for(var i=0;i<o.videoData.length;i++)o.columnItemViews[i].pauseMedia.call(o.columnItemViews[i])}}function n(o){o.options.boardViewRef.disableHandles(),o.options.boardViewRef.disableOtherColumnSurfaces(o.options.columnNumber),window.disableHUD()}function r(o,i,t,e){if(WURFL.is_mobile)i.startAudio(o.volume);else var s=new YT.Player(t,{height:o.options.YTheight,width:o.options.YTwidth,videoId:t,events:{onReady:function(){i.onPlayerReady.call(i,s,o,e)},onStateChange:function(t){i.onPlayerStateChange.call(i,t,o)}},playerVars:{autoplay:0,controls:0,showinfo:1,rel:0,modestbranding:1,fs:1,wmode:"opaque",origin:"http://musicircus.thespace.org"}})}function a(o){if(0==o.endEvent&&(o.endEvent=!0,v.setTimeout(function(){l(o)},1e3),o.options.boardViewRef.autoScrollInactive=!0,WURFL.is_mobile))for(var i=o.n,t=0;t<o.videoData.length;t++){var e=t;e!=i&&o.columnItemViews[t].pauseMedia.call(o.columnItemViews[t])}o.options.boardViewRef.enableHandles(),o.options.boardViewRef.enableAllColumnSurfaces(),window.enableHUD&&window.enableHUD()}function l(o){for(var i=o.n,t=0;t<o.videoData.length;t++){t!=i?WURFL.is_mobile?(o.columnItemViews[t].pauseMedia.call(o.columnItemViews[t]),o.columnItemViews[t].itemPhoto.setProperties({display:"none"})):(o.columnItemViews[t].pauseMedia(),o.columnItemViews[t].videoSurface&&o.columnItemViews[t].videoSurface.setProperties({display:"none"})):WURFL.is_mobile?o.columnItemViews[t].itemPhoto.setProperties({display:"block"}):o.columnItemViews[t].videoSurface&&o.columnItemViews[t].videoSurface.setProperties({display:"block"})}!WURFL.is_mobile&&o.columnItemViews[i].madeVideo()?(o.columnItemViews[i].playMedia(),o.columnItemViews[i].changeVolume(o.volume)):(o.columnItemViews[i].setVolume(o.volume),r(o,o.columnItemViews[i],o.videoData[i].code,i)),o.endEvent=!1}function u(o){var i=Math.floor(-o.scrollSurface.draggable.getPosition()[1]/(o.options.columnItemHeight+o.options.margin));return i<0&&(i=0),i>=o.videoData.length&&(i=o.videoData.length-1),i}function c(o,i,t){if(void 0===i){var e=!0;i=u(o)}var s,n,r=o.scrollSurface.draggable.getPosition()[1];s=r>o.ypos?i>0&&e?i-1:i:r<o.ypos&&i+1<o.videoData.length&&e?i+1:i,u(o)==o.n?n=-s*(o.options.columnItemHeight+o.options.margin):(n=-i*(o.options.columnItemHeight+o.options.margin),s=i),o.ypos=n,o.n=s,"slow"==t?o.scrollSurface.draggable.setPosition([0,n,0],o.slowTrans):o.scrollSurface.draggable.setPosition([0,n,0],o.trans)}function d(){var o=this,i=new b(0),t=new I({content:"images/up_ball.png",size:[50,50],properties:{pointerEvents:"all",zIndex:50,cursor:"pointer"}}),e=new g({origin:[.5,.5],align:[.5,.1]}),s=new w({opacity:function(){return i.get()}});this.add(e).add(s).add(t);var n=new I({content:"images/down_ball.png",size:[50,50],properties:{pointerEvents:"all",zIndex:50,cursor:"pointer"}}),r=new g({origin:[.5,.5],align:[.5,.75]}),a=new w({opacity:function(){return i.get()}});this.add(r).add(a).add(n),window.debug?(n.on("mouseup",function(){o.snapGotoNode(1)},!1),t.on("mouseup",function(){o.snapGotoNode(-1)},!1)):WURFL.is_mobile?(n.on("touchend",function(){o.snapGotoNode(1)},!1),t.on("touchend",function(){o.snapGotoNode(-1)},!1)):(n.on("mouseup",function(){o.snapGotoNode(1)},!1),t.on("mouseup",function(){o.snapGotoNode(-1)},!1));var l;window.debug?(n.on("mouseenter",function(){v.clear(l)}),t.on("mouseenter",function(){v.clear(l)}),this.scrollSurface.on("mouseenter",function(o){v.clear(l),i.set(1,{duration:500,curve:M.outCirc})}),this.scrollSurface.on("mouseleave",function(o){v.clear(l),l=v.setTimeout(function(){i.set(0,{duration:500,curve:M.outCirc})},500)})):WURFL.is_mobile?(n.on("touchstart",function(){v.clear(l),l=v.setTimeout(function(){i.set(0,{duration:500,curve:M.outCirc})},1e3)}),t.on("touchstart",function(){v.clear(l),l=v.setTimeout(function(){i.set(0,{duration:500,curve:M.outCirc})},1e3)}),this.scrollSurface.on("touchstart",function(o){v.clear(l),i.set(1,{duration:500,curve:M.outCirc})}),this.scrollSurface.on("touchend",function(o){v.clear(l),l=v.setTimeout(function(){i.set(0,{duration:500,curve:M.outCirc})},1e3)})):(n.on("mouseenter",function(){v.clear(l)}),t.on("mouseenter",function(){v.clear(l)}),this.scrollSurface.on("mouseenter",function(o){v.clear(l),i.set(1,{duration:500,curve:M.outCirc}),l=v.setTimeout(function(){i.set(0,{duration:2e3,curve:M.outCirc})},3e3)}),this.scrollSurface.on("mouseleave",function(o){v.clear(l),l=v.setTimeout(function(){i.set(0,{duration:50,curve:M.outCirc})},50)}))}var m=o("famous/core/View"),h=o("famous/core/Surface"),f=o("famous/surfaces/ContainerSurface"),p=(o("famous/views/Scrollview"),o("famous/core/Transform")),g=o("famous/modifiers/StateModifier"),w=o("famous/core/Modifier"),v=o("famous/utilities/Timer"),S=o("mods/Draggable"),b=o("famous/transitions/Transitionable"),I=o("famous/surfaces/ImageSurface"),M=o("famous/transitions/Easing"),V=o("famous/transitions/SnapTransition"),y=o("famous/transitions/SpringTransition");if(b.registerMethod("snap",V),b.registerMethod("spring",y),WURFL.is_mobile)var C=o("views/MobileColumnItemView");else var C=o("views/ColumnItemView");var T=o("data/DataArray");o("famous/inputs/GenericSync"),o("famous/inputs/ScrollSync"),o("famous/inputs/TouchSync");e.prototype=Object.create(m.prototype),e.prototype.constructor=e,e.DEFAULT_OPTIONS={columnCount:3,columnWidths:[.25,.5,.25],itemHeights:[.75,1,.75],YTwidth:window.innerWidth/3,YTheight:200,columnItemHeight:.25*window.innerHeight,columnWidth:.5,margin:100,isMobile:!1,boardContainer:this},e.prototype.resizeItems=function(o,i){var t=this.scrollSurfaceHeight;this.options.columnItemHeight=o[1]*i,this.options.columnWidth=o[0],this.scrollSurfaceHeight=this.videoData.length*(this.options.columnItemHeight+this.options.margin),this.scrollSurface.setSize([o[0],this.scrollSurfaceHeight]);for(var e=0;e<this.videoData.length;e++)this.columnItemMods[e].setTransform(p.translate(0,e*(o[1]+this.options.margin),0)),this.columnItemMods[e].sizeFrom([o[0],o[1]]),this.columnItemViews[e].background.setSize([o[0],o[1]]);var s=this.scrollSurface.draggable.getPosition(),n=this.scrollSurfaceHeight/t;this.scrollSurface.draggable.setPosition([s[0],s[1]*n,0]),this.volume=Math.pow(this.options.columnWidth/this.options.maxColumnWidth*100,2)/100,this.columnItemViews[this.n].changeVolume(this.volume)},e.prototype.snap=function(o){c(this,this.n,o)},e.prototype.snapRandomPlay=function(){this.options.boardViewRef.autoScrollInactive=!1;for(var o=Math.floor(Math.random()*this.videoData.length);o==this.n;)o=Math.floor(Math.random()*this.videoData.length);this.n=o,this.snap.call(this,"slow"),a(this)},e.prototype.snapGotoNode=function(o){this.n+o<this.videoData.length&&this.n+o>=0&&(this.n=this.n+o,this.snap.call(this,"slow"),a(this))},t.exports=e});