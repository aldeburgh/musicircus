/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * Owner: david@famo.us
 * @license MPL 2.0
 * @copyright Famous Industries, Inc. 2014
 */

define(["require","exports","module"],function(t,e,i){function r(t){this.options=Object.create(r.DEFAULT_OPTIONS),t&&this.setOptions(t),this._startTime=0,this._startValue=0,this._updateTime=0,this._endValue=0,this._curve=void 0,this._duration=0,this._active=!1,this._callback=void 0,this.state=0,this.velocity=void 0}function s(t,e,i){return(1-i)*t+i*e}function n(t){return t instanceof Object?t instanceof Array?t.slice(0):Object.create(t):t}function u(t,e){var i={curve:e.curve};return e.duration&&(i.duration=e.duration),e.speed&&(i.speed=e.speed),t instanceof Object&&(void 0!==t.duration&&(i.duration=t.duration),t.curve&&(i.curve=t.curve),t.speed&&(i.speed=t.speed)),"string"==typeof i.curve&&(i.curve=r.getCurve(i.curve)),i}function a(t,e,i,r,s){var n,u=(i(s)-i(s-1e-7))/1e-7;if(t instanceof Array){n=[];for(var a=0;a<t.length;a++)"number"==typeof t[a]?n[a]=u*(t[a]-e[a])/r:n[a]=0}else n=u*(t-e)/r;return n}function o(t,e,i){var r;if(t instanceof Array){r=[];for(var n=0;n<t.length;n++)"number"==typeof t[n]?r[n]=s(t[n],e[n],i):r[n]=t[n]}else r=s(t,e,i);return r}r.Curves={linear:function(t){return t},easeIn:function(t){return t*t},easeOut:function(t){return t*(2-t)},easeInOut:function(t){return t<=.5?2*t*t:-2*t*t+4*t-1},easeOutBounce:function(t){return t*(3-2*t)},spring:function(t){return(1-t)*Math.sin(6*Math.PI*t)+t}},r.SUPPORTS_MULTIPLE=!0,r.DEFAULT_OPTIONS={curve:r.Curves.linear,duration:500,speed:0};var c={};r.registerCurve=function(t,e){return!c[t]&&(c[t]=e,!0)},r.unregisterCurve=function(t){return!!c[t]&&(delete c[t],!0)},r.getCurve=function(t){var e=c[t];if(void 0!==e)return e;throw new Error("curve not registered")},r.getCurves=function(){return c},r.prototype.setOptions=function(t){void 0!==t.curve&&(this.options.curve=t.curve),void 0!==t.duration&&(this.options.duration=t.duration),void 0!==t.speed&&(this.options.speed=t.speed)},r.prototype.set=function(t,e,i){if(!e)return this.reset(t),void(i&&i());if(this._startValue=n(this.get()),e=u(e,this.options),e.speed){var r=this._startValue;if(r instanceof Object){var s=0;for(var a in r)s+=(t[a]-r[a])*(t[a]-r[a]);e.duration=Math.sqrt(s)/e.speed}else e.duration=Math.abs(t-r)/e.speed}this._startTime=Date.now(),this._endValue=n(t),this._startVelocity=n(e.velocity),this._duration=e.duration,this._curve=e.curve,this._active=!0,this._callback=i},r.prototype.reset=function(t,e){if(this._callback){var i=this._callback;this._callback=void 0,i()}this.state=n(t),this.velocity=n(e),this._startTime=0,this._duration=0,this._updateTime=0,this._startValue=this.state,this._startVelocity=this.velocity,this._endValue=this.state,this._active=!1},r.prototype.getVelocity=function(){return this.velocity},r.prototype.get=function(t){return this.update(t),this.state},r.prototype.update=function(t){if(this._active){if(t||(t=Date.now()),!(this._updateTime>=t)){this._updateTime=t;var e=t-this._startTime;if(e>=this._duration)this.state=this._endValue,this.velocity=a(this.state,this._startValue,this._curve,this._duration,1),this._active=!1;else if(e<0)this.state=this._startValue,this.velocity=this._startVelocity;else{var i=e/this._duration;this.state=o(this._startValue,this._endValue,this._curve(i)),this.velocity=a(this.state,this._startValue,this._curve,this._duration,i)}}}else if(this._callback){var r=this._callback;this._callback=void 0,r()}},r.prototype.isActive=function(){return this._active},r.prototype.halt=function(){this.reset(this.get())},r.registerCurve("linear",r.Curves.linear),r.registerCurve("easeIn",r.Curves.easeIn),r.registerCurve("easeOut",r.Curves.easeOut),r.registerCurve("easeInOut",r.Curves.easeInOut),r.registerCurve("easeOutBounce",r.Curves.easeOutBounce),r.registerCurve("spring",r.Curves.spring),r.customCurve=function(t,e){return t=t||0,e=e||0,function(i){return t*i+(-2*t-e+3)*i*i+(t+e-2)*i*i*i}},i.exports=r});