define(["require","exports","module","famous/core/Entity","famous/core/Group","famous/core/OptionsManager","famous/core/Transform","famous/utilities/Utility","famous/core/ViewSequence","famous/core/EventHandler"],function(t,i,e){function o(t){this.options=Object.create(this.constructor.DEFAULT_OPTIONS),this._optionsManager=new c(this.options),t&&this._optionsManager.setOptions(t),this._node=null,this._position=0,this._positionOffset=0,this._positionGetter=null,this._outputFunction=null,this._masterOutputFunction=null,this.outputFrom(),this._onEdge=0,this.group=new _,this.group.add({render:u.bind(this)}),this._entityId=p.register(this),this._size=[void 0,void 0],this._contextSize=[void 0,void 0],this._eventInput=new f,this._eventOutput=new f,f.setInputHandler(this,this._eventInput),f.setOutputHandler(this,this._eventOutput)}function s(t){t||(t=this._contextSize);var i=this.options.direction===a.Direction.X?0:1;return void 0===t[i]?this._contextSize[i]:t[i]}function n(t,i,e){var o=t.getSize?t.getSize():this._contextSize,n=this._outputFunction(i);return e.push({transform:n,target:t.render()}),s.call(this,o)}function r(){return this.options.clipSize?this.options.clipSize:s.call(this,this._contextSize)}function h(){for(var t=s.call(this,this._node.getSize()),i=this._node&&this._node.getNext?this._node.getNext():null;i&&this._position+this._positionOffset>=t;)this._positionOffset-=t,this._node=i,t=s.call(this,this._node.getSize()),i=this._node&&this._node.getNext?this._node.getNext():null;for(var e=this._node&&this._node.getPrevious?this._node.getPrevious():null;e&&this._position+this._positionOffset<0;){var o=s.call(this,e.getSize());this._positionOffset+=o,this._node=e,e=this._node&&this._node.getPrevious?this._node.getPrevious():null}}function u(){var t=null,i=this._position,e=[];this._onEdge=0;for(var o=-this._positionOffset,u=r.call(this),p=this._node;p&&o-i<u+this.options.margin;)o+=n.call(this,p,o,e),p=p.getNext?p.getNext():null;var _=this._node,c=s.call(this,_.getSize());if(o<u){for(;_&&c<u;)(_=_.getPrevious())&&(c+=s.call(this,_.getSize()));for(_=this._node;_&&c<u;)(_=_.getNext())&&(c+=s.call(this,_.getSize()))}var l=void 0!==c&&c<u?c:u;for(!p&&o-i<=l?(this._onEdge=1,this._eventOutput.emit("edgeHit",{position:o-l})):!this._node.getPrevious()&&i<=0&&(this._onEdge=-1,this._eventOutput.emit("edgeHit",{position:0})),p=this._node&&this._node.getPrevious?this._node.getPrevious():null,o=-this._positionOffset,p&&(t=p.getSize?p.getSize():this._contextSize,o-=s.call(this,t));p&&o-i>-(r.call(this)+this.options.margin);)n.call(this,p,o,e),(p=p.getPrevious?p.getPrevious():null)&&(t=p.getSize?p.getSize():this._contextSize,o-=s.call(this,t));return h.call(this),e}var p=t("famous/core/Entity"),_=t("famous/core/Group"),c=t("famous/core/OptionsManager"),l=t("famous/core/Transform"),a=t("famous/utilities/Utility"),d=t("famous/core/ViewSequence"),f=t("famous/core/EventHandler");o.DEFAULT_OPTIONS={direction:a.Direction.Y,margin:0,clipSize:void 0,groupScroll:!1},o.prototype.setOptions=function(t){this._optionsManager.setOptions(t),this.options.groupScroll?this.group.pipe(this._eventOutput):this.group.unpipe(this._eventOutput)},o.prototype.onEdge=function(){return this._onEdge},o.prototype.outputFrom=function(t,i){t||(t=function(t){return this.options.direction===a.Direction.X?l.translate(t,0):l.translate(0,t)}.bind(this),i||(i=t)),this._outputFunction=t,this._masterOutputFunction=i||function(i){return l.inverse(t(-i))}},o.prototype.positionFrom=function(t){t instanceof Function?this._positionGetter=t:t&&t.get?this._positionGetter=t.get.bind(t):(this._positionGetter=null,this._position=t),this._positionGetter&&(this._position=this._positionGetter.call(this))},o.prototype.sequenceFrom=function(t){t instanceof Array&&(t=new d({array:t})),this._node=t,this._positionOffset=0},o.prototype.getSize=function(t){return t?this._contextSize:this._size},o.prototype.render=function(){return this._node?(this._positionGetter&&(this._position=this._positionGetter.call(this)),this._entityId):null},o.prototype.commit=function(t){var i=t.transform,e=t.opacity,o=t.origin,s=t.size;this.options.clipSize||s[0]===this._contextSize[0]&&s[1]===this._contextSize[1]||(this._onEdge=0,this._contextSize[0]=s[0],this._contextSize[1]=s[1],this.options.direction===a.Direction.X?(this._size[0]=r.call(this),this._size[1]=void 0):(this._size[0]=void 0,this._size[1]=r.call(this)));var n=this._masterOutputFunction(-this._position);return{transform:l.multiply(i,n),size:s,opacity:e,origin:o,target:this.group.render()}},e.exports=o});