define(["require","exports","module","famous/core/Transform","famous/core/Modifier","famous/core/RenderNode","famous/utilities/Utility","famous/core/OptionsManager","famous/transitions/Transitionable","famous/transitions/TransitionableTransform"],function(i,s,t){function o(i){this.options=Object.create(o.DEFAULT_OPTIONS),this._optionsManager=new h(this.options),i&&this.setOptions(i),this._showing=!1,this.nodes=[],this.transforms=[],this.states=[]}var n=i("famous/core/Transform"),r=i("famous/core/Modifier"),e=i("famous/core/RenderNode"),a=i("famous/utilities/Utility"),h=i("famous/core/OptionsManager"),f=i("famous/transitions/Transitionable"),p=i("famous/transitions/TransitionableTransform");o.DEFAULT_OPTIONS={inTransform:n.scale(.001,.001,.001),inOpacity:0,inOrigin:[.5,.5],outTransform:n.scale(.001,.001,.001),outOpacity:0,outOrigin:[.5,.5],showTransform:n.identity,showOpacity:1,showOrigin:[.5,.5],inTransition:!0,outTransition:!0,overlap:!1},o.prototype.setOptions=function(i){return this._optionsManager.setOptions(i)},o.prototype.show=function(i,s,t){if(!i)return this.hide(t);if(s instanceof Function&&(t=s,s=void 0),this._showing){if(!this.options.overlap)return this.hide(this.show.bind(this,i,s,t));this.hide()}this._showing=!0;var o={transform:new p(this.options.inTransform),origin:new f(this.options.inOrigin),opacity:new f(this.options.inOpacity)},n=new r({transform:o.transform,opacity:o.opacity,origin:o.origin}),h=new e;h.add(n).add(i),this.nodes.push(h),this.states.push(o),this.transforms.push(n);var u=t?a.after(3,t):void 0;s||(s=this.options.inTransition),o.transform.set(this.options.showTransform,s,u),o.opacity.set(this.options.showOpacity,s,u),o.origin.set(this.options.showOrigin,s,u)},o.prototype.hide=function(i,s){if(this._showing){this._showing=!1,i instanceof Function&&(s=i,i=void 0);var t=this.nodes[this.nodes.length-1],o=this.transforms[this.transforms.length-1],n=this.states[this.states.length-1],r=a.after(3,function(){this.nodes.splice(this.nodes.indexOf(t),1),this.states.splice(this.states.indexOf(n),1),this.transforms.splice(this.transforms.indexOf(o),1),s&&s.call(this)}.bind(this));i||(i=this.options.outTransition),n.transform.set(this.options.outTransform,i,r),n.opacity.set(this.options.outOpacity,i,r),n.origin.set(this.options.outOrigin,i,r)}},o.prototype.render=function(){for(var i=[],s=0;s<this.nodes.length;s++)i.push(this.nodes[s].render());return i},t.exports=o});