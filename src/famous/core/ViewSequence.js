/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * Owner: mark@famo.us
 * @license MPL 2.0
 * @copyright Famous Industries, Inc. 2014
 */

define(["require","exports","module"],function(t,e,i){function s(t){t||(t=[]),t instanceof Array&&(t={array:t}),this._=null,this.index=t.index||0,t.array?this._=new this.constructor.Backing(t.array):t._&&(this._=t._),this.index===this._.firstIndex&&(this._.firstNode=this),this.index===this._.firstIndex+this._.array.length-1&&(this._.lastNode=this),void 0!==t.loop&&(this._.loop=t.loop),this._previousNode=null,this._nextNode=null}s.Backing=function(t){this.array=t,this.firstIndex=0,this.loop=!1,this.firstNode=null,this.lastNode=null},s.Backing.prototype.getValue=function(t){var e=t-this.firstIndex;return e<0||e>=this.array.length?null:this.array[e]},s.Backing.prototype.setValue=function(t,e){this.array[t-this.firstIndex]=e},s.Backing.prototype.reindex=function(t,e,i){if(this.array[0]){for(var s=0,o=this.firstIndex,n=i-e,r=this.firstNode;o<t-1;)r=r.getNext(),o++;var h=r;for(s=0;s<e;s++)(r=r.getNext())&&(r._previousNode=h);var d=r?r.getNext():null;for(h._nextNode=null,r=h,s=0;s<i;s++)r=r.getNext();if(o+=i,r!==d&&(r._nextNode=d,d&&(d._previousNode=r)),d)for(r=d,o++;r&&o<this.array.length+this.firstIndex;)r._nextNode?r.index+=n:r.index=o,r=r.getNext(),o++}},s.prototype.getPrevious=function(){return this.index===this._.firstIndex?this._.loop?(this._previousNode=this._.lastNode||new this.constructor({_:this._,index:this._.firstIndex+this._.array.length-1}),this._previousNode._nextNode=this):this._previousNode=null:this._previousNode||(this._previousNode=new this.constructor({_:this._,index:this.index-1}),this._previousNode._nextNode=this),this._previousNode},s.prototype.getNext=function(){return this.index===this._.firstIndex+this._.array.length-1?this._.loop?(this._nextNode=this._.firstNode||new this.constructor({_:this._,index:this._.firstIndex}),this._nextNode._previousNode=this):this._nextNode=null:this._nextNode||(this._nextNode=new this.constructor({_:this._,index:this.index+1}),this._nextNode._previousNode=this),this._nextNode},s.prototype.getIndex=function(){return this.index},s.prototype.toString=function(){return""+this.index},s.prototype.unshift=function(t){this._.array.unshift.apply(this._.array,arguments),this._.firstIndex-=arguments.length},s.prototype.push=function(t){this._.array.push.apply(this._.array,arguments)},s.prototype.splice=function(t,e){var i=Array.prototype.slice.call(arguments,2);this._.array.splice.apply(this._.array,[t-this._.firstIndex,e].concat(i)),this._.reindex(t,e,i.length)},s.prototype.swap=function(t){var e=t.get(),i=this.get();this._.setValue(this.index,e),this._.setValue(t.index,i);var s=this._previousNode,o=this._nextNode,n=this.index,r=t._previousNode,h=t._nextNode,d=t.index;this.index=d,this._previousNode=r===this?t:r,this._previousNode&&(this._previousNode._nextNode=this),this._nextNode=h===this?t:h,this._nextNode&&(this._nextNode._previousNode=this),t.index=n,t._previousNode=s===t?this:s,t._previousNode&&(t._previousNode._nextNode=t),t._nextNode=o===t?this:o,t._nextNode&&(t._nextNode._previousNode=t),this.index===this._.firstIndex?this._.firstNode=this:this.index===this._.firstIndex+this._.array.length-1&&(this._.lastNode=this),t.index===this._.firstIndex?this._.firstNode=t:t.index===this._.firstIndex+this._.array.length-1&&(this._.lastNode=t)},s.prototype.get=function(){return this._.getValue(this.index)},s.prototype.getSize=function(){var t=this.get();return t?t.getSize():null},s.prototype.render=function(){var t=this.get();return t?t.render.apply(t,arguments):null},i.exports=s});