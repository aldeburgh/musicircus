/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * Owner: mark@famo.us
 * @license MPL 2.0
 * @copyright Famous Industries, Inc. 2014
 */

define(["require","exports","module","./ElementOutput"],function(t,s,e){function i(t){h.call(this),this.options={},this.properties={},this.content="",this.classList=[],this.size=null,this._classesDirty=!0,this._stylesDirty=!0,this._sizeDirty=!0,this._contentDirty=!0,this._dirtyClasses=[],t&&this.setOptions(t),this._currentTarget=null}function r(t){for(var s=0;s<this._dirtyClasses.length;s++)t.classList.remove(this._dirtyClasses[s]);this._dirtyClasses=[]}function n(t){for(var s in this.properties)t.style[s]=this.properties[s]}function o(t){for(var s in this.properties)t.style[s]=""}function l(t,s){return t&&s?t[0]!==s[0]||t[1]!==s[1]:t!==s}var h=t("./ElementOutput");i.prototype=Object.create(h.prototype),i.prototype.constructor=i,i.prototype.elementType="div",i.prototype.elementClass="famous-surface",i.prototype.setProperties=function(t){for(var s in t)this.properties[s]=t[s];this._stylesDirty=!0},i.prototype.getProperties=function(){return this.properties},i.prototype.addClass=function(t){this.classList.indexOf(t)<0&&(this.classList.push(t),this._classesDirty=!0)},i.prototype.removeClass=function(t){var s=this.classList.indexOf(t);s>=0&&(this._dirtyClasses.push(this.classList.splice(s,1)[0]),this._classesDirty=!0)},i.prototype.toggleClass=function(t){this.classList.indexOf(t)>=0?this.removeClass(t):this.addClass(t)},i.prototype.setClasses=function(t){var s=0,e=[];for(s=0;s<this.classList.length;s++)t.indexOf(this.classList[s])<0&&e.push(this.classList[s]);for(s=0;s<e.length;s++)this.removeClass(e[s]);for(s=0;s<t.length;s++)this.addClass(t[s])},i.prototype.getClassList=function(){return this.classList},i.prototype.setContent=function(t){this.content!==t&&(this.content=t,this._contentDirty=!0)},i.prototype.getContent=function(){return this.content},i.prototype.setOptions=function(t){t.size&&this.setSize(t.size),t.classes&&this.setClasses(t.classes),t.properties&&this.setProperties(t.properties),t.content&&this.setContent(t.content)},i.prototype.setup=function(t){var s=t.allocate(this.elementType);if(this.elementClass)if(this.elementClass instanceof Array)for(var e=0;e<this.elementClass.length;e++)s.classList.add(this.elementClass[e]);else s.classList.add(this.elementClass);s.style.display="",this.attach(s),this._currentTarget=s,this._stylesDirty=!0,this._classesDirty=!0,this._sizeDirty=!0,this._contentDirty=!0,this._transformDirty=!0},i.prototype.commit=function(t){this._currentTarget||this.setup(t.allocator);var s=this._currentTarget,e=t.size;if(this._classesDirty){r.call(this,s);for(var i=this.getClassList(),o=0;o<i.length;o++)s.classList.add(i[o]);this._classesDirty=!1}if(this._stylesDirty&&(n.call(this,s),this._stylesDirty=!1),this.size){var a=t.size;e=[this.size[0],this.size[1]],void 0===e[0]?e[0]=a[0]:!0===e[0]&&(e[0]=s.clientWidth),void 0===e[1]?e[1]=a[1]:!0===e[1]&&(e[1]=s.clientHeight)}l(this._size,e)&&(this._size||(this._size=[0,0]),this._size[0]=e[0],this._size[1]=e[1],this._sizeDirty=!0),this._sizeDirty&&(this._size&&(s.style.width=this.size&&!0===this.size[0]?"":this._size[0]+"px",s.style.height=this.size&&!0===this.size[1]?"":this._size[1]+"px"),this._sizeDirty=!1),this._contentDirty&&(this.deploy(s),this._eventOutput.emit("deploy"),this._contentDirty=!1),h.prototype.commit.call(this,t)},i.prototype.cleanup=function(t){var s=0,e=this._currentTarget;this._eventOutput.emit("recall"),this.recall(e),e.style.display="none",e.style.width="",e.style.height="",this._size=null,o.call(this,e);var i=this.getClassList();for(r.call(this,e),s=0;s<i.length;s++)e.classList.remove(i[s]);if(this.elementClass)if(this.elementClass instanceof Array)for(s=0;s<this.elementClass.length;s++)e.classList.remove(this.elementClass[s]);else e.classList.remove(this.elementClass);this.detach(e),this._currentTarget=null,t.deallocate(e)},i.prototype.deploy=function(t){var s=this.getContent();if(s instanceof Node){for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(s)}else t.innerHTML=s},i.prototype.recall=function(t){for(var s=document.createDocumentFragment();t.hasChildNodes();)s.appendChild(t.firstChild);this.setContent(s)},i.prototype.getSize=function(){return this._size},i.prototype.setSize=function(t){this.size=t?[t[0],t[1]]:null,this._sizeDirty=!0},e.exports=i});