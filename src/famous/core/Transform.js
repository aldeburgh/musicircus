/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * Owner: mark@famo.us
 * @license MPL 2.0
 * @copyright Famous Industries, Inc. 2014
 */

define(["require","exports","module"],function(t,a,e){function r(t){return 2===t.length?t[0]*t[0]+t[1]*t[1]:t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function n(t){return Math.sqrt(r(t))}function o(t){return t<0?-1:1}var u={};u.precision=1e-6,u.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u.multiply4x4=function(t,a){return[t[0]*a[0]+t[4]*a[1]+t[8]*a[2]+t[12]*a[3],t[1]*a[0]+t[5]*a[1]+t[9]*a[2]+t[13]*a[3],t[2]*a[0]+t[6]*a[1]+t[10]*a[2]+t[14]*a[3],t[3]*a[0]+t[7]*a[1]+t[11]*a[2]+t[15]*a[3],t[0]*a[4]+t[4]*a[5]+t[8]*a[6]+t[12]*a[7],t[1]*a[4]+t[5]*a[5]+t[9]*a[6]+t[13]*a[7],t[2]*a[4]+t[6]*a[5]+t[10]*a[6]+t[14]*a[7],t[3]*a[4]+t[7]*a[5]+t[11]*a[6]+t[15]*a[7],t[0]*a[8]+t[4]*a[9]+t[8]*a[10]+t[12]*a[11],t[1]*a[8]+t[5]*a[9]+t[9]*a[10]+t[13]*a[11],t[2]*a[8]+t[6]*a[9]+t[10]*a[10]+t[14]*a[11],t[3]*a[8]+t[7]*a[9]+t[11]*a[10]+t[15]*a[11],t[0]*a[12]+t[4]*a[13]+t[8]*a[14]+t[12]*a[15],t[1]*a[12]+t[5]*a[13]+t[9]*a[14]+t[13]*a[15],t[2]*a[12]+t[6]*a[13]+t[10]*a[14]+t[14]*a[15],t[3]*a[12]+t[7]*a[13]+t[11]*a[14]+t[15]*a[15]]},u.multiply=function(t,a){return[t[0]*a[0]+t[4]*a[1]+t[8]*a[2],t[1]*a[0]+t[5]*a[1]+t[9]*a[2],t[2]*a[0]+t[6]*a[1]+t[10]*a[2],0,t[0]*a[4]+t[4]*a[5]+t[8]*a[6],t[1]*a[4]+t[5]*a[5]+t[9]*a[6],t[2]*a[4]+t[6]*a[5]+t[10]*a[6],0,t[0]*a[8]+t[4]*a[9]+t[8]*a[10],t[1]*a[8]+t[5]*a[9]+t[9]*a[10],t[2]*a[8]+t[6]*a[9]+t[10]*a[10],0,t[0]*a[12]+t[4]*a[13]+t[8]*a[14]+t[12],t[1]*a[12]+t[5]*a[13]+t[9]*a[14]+t[13],t[2]*a[12]+t[6]*a[13]+t[10]*a[14]+t[14],1]},u.thenMove=function(t,a){return a[2]||(a[2]=0),[t[0],t[1],t[2],0,t[4],t[5],t[6],0,t[8],t[9],t[10],0,t[12]+a[0],t[13]+a[1],t[14]+a[2],1]},u.moveThen=function(t,a){t[2]||(t[2]=0);var e=t[0]*a[0]+t[1]*a[4]+t[2]*a[8],r=t[0]*a[1]+t[1]*a[5]+t[2]*a[9],n=t[0]*a[2]+t[1]*a[6]+t[2]*a[10];return u.thenMove(a,[e,r,n])},u.translate=function(t,a,e){return void 0===e&&(e=0),[1,0,0,0,0,1,0,0,0,0,1,0,t,a,e,1]},u.thenScale=function(t,a){return[a[0]*t[0],a[1]*t[1],a[2]*t[2],0,a[0]*t[4],a[1]*t[5],a[2]*t[6],0,a[0]*t[8],a[1]*t[9],a[2]*t[10],0,a[0]*t[12],a[1]*t[13],a[2]*t[14],1]},u.scale=function(t,a,e){return void 0===e&&(e=1),void 0===a&&(a=t),[t,0,0,0,0,a,0,0,0,0,e,0,0,0,0,1]},u.rotateX=function(t){var a=Math.cos(t),e=Math.sin(t);return[1,0,0,0,0,a,e,0,0,-e,a,0,0,0,0,1]},u.rotateY=function(t){var a=Math.cos(t),e=Math.sin(t);return[a,0,-e,0,0,1,0,0,e,0,a,0,0,0,0,1]},u.rotateZ=function(t){var a=Math.cos(t),e=Math.sin(t);return[a,e,0,0,-e,a,0,0,0,0,1,0,0,0,0,1]},u.rotate=function(t,a,e){var r=Math.cos(t),n=Math.sin(t),o=Math.cos(a),u=Math.sin(a),i=Math.cos(e),s=Math.sin(e);return[o*i,r*s+n*u*i,n*s-r*u*i,0,-o*s,r*i-n*u*s,n*i+r*u*s,0,u,-n*o,r*o,0,0,0,0,1]},u.rotateAxis=function(t,a){var e=Math.sin(a),r=Math.cos(a),n=1-r,o=t[0]*t[0]*n,u=t[0]*t[1]*n,i=t[0]*t[2]*n,s=t[1]*t[1]*n,h=t[1]*t[2]*n,M=t[2]*t[2]*n,c=t[0]*e,l=t[1]*e,f=t[2]*e;return[o+r,u+f,i-l,0,u-f,s+r,h+c,0,i+l,h-c,M+r,0,0,0,0,1]},u.aboutOrigin=function(t,a){var e=t[0]-(t[0]*a[0]+t[1]*a[4]+t[2]*a[8]),r=t[1]-(t[0]*a[1]+t[1]*a[5]+t[2]*a[9]),n=t[2]-(t[0]*a[2]+t[1]*a[6]+t[2]*a[10]);return u.thenMove(a,[e,r,n])},u.skew=function(t,a,e){return[1,Math.tan(a),0,0,Math.tan(e),1,0,0,0,Math.tan(t),1,0,0,0,0,1]},u.skewX=function(t){return[1,0,0,0,Math.tan(t),1,0,0,0,0,1,0,0,0,0,1]},u.skewY=function(t){return[1,Math.tan(t),0,0,0,1,0,0,0,0,1,0,0,0,0,1]},u.perspective=function(t){return[1,0,0,0,0,1,0,0,0,0,1,-1/t,0,0,0,1]},u.getTranslate=function(t){return[t[12],t[13],t[14]]},u.inverse=function(t){var a=t[5]*t[10]-t[6]*t[9],e=t[4]*t[10]-t[6]*t[8],r=t[4]*t[9]-t[5]*t[8],n=t[1]*t[10]-t[2]*t[9],o=t[0]*t[10]-t[2]*t[8],u=t[0]*t[9]-t[1]*t[8],i=t[1]*t[6]-t[2]*t[5],s=t[0]*t[6]-t[2]*t[4],h=t[0]*t[5]-t[1]*t[4],M=t[0]*a-t[1]*e+t[2]*r,c=1/M,l=[c*a,-c*n,c*i,0,-c*e,c*o,-c*s,0,c*r,-c*u,c*h,0,0,0,0,1];return l[12]=-t[12]*l[0]-t[13]*l[4]-t[14]*l[8],l[13]=-t[12]*l[1]-t[13]*l[5]-t[14]*l[9],l[14]=-t[12]*l[2]-t[13]*l[6]-t[14]*l[10],l},u.transpose=function(t){return[t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]]},u.interpret=function(t){var a=[t[0],t[1],t[2]],e=o(a[0]),i=n(a),s=[a[0]+e*i,a[1],a[2]],h=2/r(s);if(h>=1/0)return{translate:u.getTranslate(t),rotate:[0,0,0],scale:[0,0,0],skew:[0,0,0]};var M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];M[0]=1-h*s[0]*s[0],M[5]=1-h*s[1]*s[1],M[10]=1-h*s[2]*s[2],M[1]=-h*s[0]*s[1],M[2]=-h*s[0]*s[2],M[6]=-h*s[1]*s[2],M[4]=M[1],M[8]=M[2],M[9]=M[6];var c=u.multiply(M,t),l=[c[5],c[6]],f=o(l[0]),I=n(l),P=[l[0]+f*I,l[1]],v=2/r(P),p=[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];p[5]=1-v*P[0]*P[0],p[10]=1-v*P[1]*P[1],p[6]=-v*P[0]*P[1],p[9]=p[6];var k=u.multiply(p,M),w=u.multiply(k,t),m=u.scale(w[0]<0?-1:1,w[5]<0?-1:1,w[10]<0?-1:1);w=u.multiply(w,m),k=u.multiply(m,k);var d={};return d.translate=u.getTranslate(t),d.rotate=[Math.atan2(-k[6],k[10]),Math.asin(k[2]),Math.atan2(-k[1],k[0])],d.rotate[0]||(d.rotate[0]=0,d.rotate[2]=Math.atan2(k[4],k[5])),d.scale=[w[0],w[5],w[10]],d.skew=[Math.atan2(w[9],d.scale[2]),Math.atan2(w[8],d.scale[2]),Math.atan2(w[4],d.scale[0])],Math.abs(d.rotate[0])+Math.abs(d.rotate[2])>1.5*Math.PI&&(d.rotate[1]=Math.PI-d.rotate[1],d.rotate[1]>Math.PI&&(d.rotate[1]-=2*Math.PI),d.rotate[1]<-Math.PI&&(d.rotate[1]+=2*Math.PI),d.rotate[0]<0?d.rotate[0]+=Math.PI:d.rotate[0]-=Math.PI,d.rotate[2]<0?d.rotate[2]+=Math.PI:d.rotate[2]-=Math.PI),d},u.average=function(t,a,e){e=void 0===e?.5:e;for(var r=u.interpret(t),n=u.interpret(a),o={translate:[0,0,0],rotate:[0,0,0],scale:[0,0,0],skew:[0,0,0]},i=0;i<3;i++)o.translate[i]=(1-e)*r.translate[i]+e*n.translate[i],o.rotate[i]=(1-e)*r.rotate[i]+e*n.rotate[i],o.scale[i]=(1-e)*r.scale[i]+e*n.scale[i],o.skew[i]=(1-e)*r.skew[i]+e*n.skew[i];return u.build(o)},u.build=function(t){var a=u.scale(t.scale[0],t.scale[1],t.scale[2]),e=u.skew(t.skew[0],t.skew[1],t.skew[2]),r=u.rotate(t.rotate[0],t.rotate[1],t.rotate[2]);return u.thenMove(u.multiply(u.multiply(r,e),a),t.translate)},u.equals=function(t,a){return!u.notEquals(t,a)},u.notEquals=function(t,a){return t!==a&&(!(t&&a)||t[12]!==a[12]||t[13]!==a[13]||t[14]!==a[14]||t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[4]!==a[4]||t[5]!==a[5]||t[6]!==a[6]||t[8]!==a[8]||t[9]!==a[9]||t[10]!==a[10])},u.normalizeRotation=function(t){var a=t.slice(0);for(a[0]!==.5*Math.PI&&a[0]!==.5*-Math.PI||(a[0]=-a[0],a[1]=Math.PI-a[1],a[2]-=Math.PI),a[0]>.5*Math.PI&&(a[0]=a[0]-Math.PI,a[1]=Math.PI-a[1],a[2]-=Math.PI),a[0]<.5*-Math.PI&&(a[0]=a[0]+Math.PI,a[1]=-Math.PI-a[1],a[2]-=Math.PI);a[1]<-Math.PI;)a[1]+=2*Math.PI;for(;a[1]>=Math.PI;)a[1]-=2*Math.PI;for(;a[2]<-Math.PI;)a[2]+=2*Math.PI;for(;a[2]>=Math.PI;)a[2]-=2*Math.PI;return a},u.inFront=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,.001,1],u.behind=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,-.001,1],e.exports=u});